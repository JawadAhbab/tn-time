"use strict";var e=require("tn-numpad"),t=require("tn-validate");const s="d|D|m|M|y|Y|h|H|i|s|S|a|A".split("|"),n="d|D|m|M|h|H|i|s|S".split("|"),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];let s="am";return e.getHours()>=12&&(s="pm"),t&&(s=s.toUpperCase()),s},r=function(t,s){let n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n="date"===s?t.getDate():"min"===s?t.getMinutes():"sec"===s?t.getSeconds():t.getMilliseconds(),i){const t="ms"===s?3:2;n=e.numpad(n,t)}return n},a="Sun|Mon|Tue|Wed|Thu|Fri|Sat".split("|"),u="Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday".split("|"),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=e.getDay();return t?u[s]:a[s]},c=(t,s,n)=>{let i=t.getHours();return s||(i>12&&(i-=12),0===i&&(i=12)),n&&(i=e.numpad(i,2)),i},m="Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec".split("|"),l="January|February|March|April|May|June|July|August|September|October|November|December".split("|"),d=(t,s,n)=>{let i=t.getMonth();return s?n?l[i]:m[i]:(++i,n?e.numpad(i,2):i)},h=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e.getFullYear();return t||(s=s.toString().substr(2,2)),s},y=e=>({d:()=>r(e,"date"),dd:()=>r(e,"date",!0),D:()=>o(e),DD:()=>o(e,!0),m:()=>d(e,!1,!1),mm:()=>d(e,!1,!0),M:()=>d(e,!0,!1),MM:()=>d(e,!0,!0),y:()=>h(e),Y:()=>h(e,!0),h:()=>c(e,!1,!1),hh:()=>c(e,!1,!0),H:()=>c(e,!0,!1),HH:()=>c(e,!0,!0),i:()=>r(e,"min"),ii:()=>r(e,"min",!0),s:()=>r(e,"sec"),ss:()=>r(e,"sec",!0),S:()=>r(e,"ms"),SS:()=>r(e,"ms",!0),a:()=>i(e),A:()=>i(e,!0)}),p=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{zone:r}=i;let a=e;r&&(a=new Date(new Date(e).toLocaleString("en-US",{timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})));return((e,t)=>{let s="";const n=y(e);return t.forEach((e=>{if(!e.iskey)return s+=e.char;s+=n[e.char]().toString()})),s})(a,(e=>{const t=[];let i=!1,r="",a=!1;return e.split("").forEach((e=>{if("{"!==e){if("}"===e)return t.push({iskey:!1,char:r}),r="",void(i=!1);if(i)r+=e;else{if(a)s.includes(e)&&e===a?t.push({iskey:!0,char:e+e}):s.includes(e)?(t.push({iskey:!0,char:a}),t.push({iskey:!0,char:e})):(t.push({iskey:!0,char:a}),t.push({iskey:!1,char:e}));else{if(n.includes(e))return void(a=e);s.includes(e)?t.push({iskey:!0,char:e}):t.push({iskey:!1,char:e})}a=!1}}else i=!0})),a&&t.push({iskey:!0,char:a}),t})(t??"dd-mm-Y"))},g=36e5,f=24*g,D={msec:1,yr:365*f,sec:1e3,min:6e4,hr:g,day:f,mo:30*f},M=(e,t,s)=>D[e]>=D[s],v=e=>e.getTime()>(new Date).getTime(),b=e=>e.getTime()<(new Date).getTime(),S=(e,t)=>({clause:t,number:e/D[t]}),k=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;const r=t[t.length-1]??"yr";let a;if(i)a=S(e,i);else for(const s of t)if(!(e<D[s]&&r!==s)){a=S(e,s);break}if(n.length+1>=s)return n.push(a),n;{const e=t[t.findIndex((e=>e===a.clause))+1];if(e){const i=Math.floor(a.number),r=Math.round(D[a.clause]*(a.number-i));return a.number=i,n.push(a),k(r,t,s,n,e)}return n.push(a),n}},T=e=>{const s=w[e.variant];return Object.entries(e.formats).forEach((e=>{let[n,i]=e;const r=i;s[n]=t.isArray(r)?r:[r,r]})),s},w={minimal:{yr:["y","y"],mo:["mo","mo"],day:["d","d"],hr:["h","h"],min:["m","m"],sec:["s","s"],msec:["ms","ms"]},short:{yr:[" yr"," yrs"],mo:[" mo"," mos"],day:[" day"," days"],hr:[" hr"," hrs"],min:[" min"," mins"],sec:[" sec"," secs"],msec:[" msec"," msecs"]},verbose:{yr:[" year"," years"],mo:[" month"," months"],day:[" day"," days"],hr:[" hour"," hours"],min:[" minute"," minutes"],sec:[" second"," seconds"],msec:[" millisecond"," milliseconds"]},bangla:{yr:[" বছর"," বছর"],mo:[" মাস"," মাস"],day:[" দিন"," দিন"],hr:[" ঘণ্টা"," ঘণ্টা"],min:[" মিনিট"," মিনিট"],sec:[" সেকেন্ড"," সেকেন্ড"],msec:[" মিলিসেকেন্ড"," মিলিসেকেন্ড"]}},A={decimal:0,maxClause:1,clauseJoin:" ",lastBlankClause:!1,trimBlankClause:!1,variant:"verbose",formats:{},prefix:"",postfix:"",clauses:["yr","day","hr","min","sec"]};function x(e,t,s){const{gapms:n,opts:i}=((e,t)=>({gapms:Math.abs((new Date).getTime()-e.getTime()),opts:{...A,...t||{}}}))(t,s);let r=n;("AGO"===e&&v(t)||"REMAIN"===e&&b(t))&&(r=0);return(e=>{let{amounts:t,opts:s}=e;const{decimal:n,trimBlankClause:i,lastBlankClause:r,prefix:a,clauseJoin:u,postfix:o}=s,c=T(s),m=[];return t.forEach(((e,s)=>{let{number:a,clause:u}=e;const o=parseFloat(a.toFixed(n)),l=`${o}${c[u][o<=1?0:1]}`;(0===s||!i&&(t.length-1!==s||r)||o)&&m.push(l)})),`${a}${m.join(u)}${o}`})({opts:i,amounts:k(r,(e=>{const t=[];return e.includes("yr")&&t.push("yr"),e.includes("mo")&&t.push("mo"),e.includes("day")&&t.push("day"),e.includes("hr")&&t.push("hr"),e.includes("min")&&t.push("min"),e.includes("sec")&&t.push("sec"),e.includes("msec")&&t.push("msec"),t})(i.clauses),i.maxClause)})}const F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"day";const s=new Date(e);return M(t,0,"yr")&&s.setMonth(0),M(t,0,"mo")&&s.setDate(1),M(t,0,"day")&&s.setHours(0),M(t,0,"hr")&&s.setMinutes(0),M(t,0,"min")&&s.setSeconds(0),s.setMilliseconds(0),new Date(s)};exports.time=e=>{let t=e?new Date(e):new Date;return isNaN(t.getTime())&&(t=new Date),{getDate:()=>t,format:(e,s)=>p(t,e,s),gap:e=>x("GAP",t,e),ago:e=>x("AGO",t,e),remain:e=>x("REMAIN",t,e),shift:(e,s)=>function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day";const n=e.getTime()+t*D[s];return new Date(n)}(t,e,s),round:e=>F(t,e),isToday:()=>(e=>F(e).getTime()===F(new Date).getTime())(t),isPast:()=>b(t),isFuture:()=>v(t)}};
